---
layout: post
title: Linux built-in driver load order
date: '2013-03-26T13:32:00.002+05:00'
author: Abbas Raza
tags: 
modified_time: '2013-03-26T13:35:00.027+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-8371706156353378520
blogger_orig_url: https://abbas-raza.blogspot.com/2013/03/linux-built-in-driver-load-order.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div class="vote">Built-in drivers wont be <em>loaded</em>,  hence built-in.  Their initialization functions are called and the  drivers are activated when kernel sets up itself.  These init functions  are called in <code>init/main.c::do_initcalls()</code>.  All init calls are classified in levels, which are defined in <code>initcall_levels</code> and <code>include/linux/init.h</code><a class="vote-up-off" href="http://www.blogger.com/blogger.g?blogID=3367966882409306161" title="This answer is useful (click again to undo)"></a></div><div class="post-text">These levels are actuall symbols defined in linker script (<code>arch/*/kernel/vmlinux.lds.*</code>).  <span style="background-color: yellow;">At kernel compile time, the linker collects all function marked <code>module_init()</code> or other <code>*_initcall()</code>,  classify in levels, put all functions in the same level together in the  same place, and create like an array of function pointers.</span><br />What do_initcall_level() does in the run-time is to call each  function pointed by the pointers in the array.  There is no calling  policy, except levels, in do_initcall_level, but the order in the array  is decided in the link time.<br />So, now you can see that the driver's initiation order is fixed at the link time, but what can you do?<br /><ol><li>put your init function in the higher level, or</li><li>put your device driver at the higher position in <code>Makefile</code></li></ol>The first one is clear if you've read the above.  ie) use early_initcall() instead if it is appropriate.<br />The second one needs a bit more explanation.  <span style="background-color: yellow;">The reason why the order in a <code>Makefile</code> matter is how the current kernel build system works and how the linkers  works.  To make a long story short, the build system takes all object  files in <code>obj-y</code> and link them together.  It is highly  environment dependent but there is high probability that the linker  place first object file in the <code>obj-y</code> in lower address, thus, called earlier.</span><br />If you just want your driver to be called earlier than other drivers in the same directory, this is simplest way to do it.</div></div>