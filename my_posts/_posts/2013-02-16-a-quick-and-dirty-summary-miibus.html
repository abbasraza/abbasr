---
layout: post
title: 'A quick and dirty summary: miibus  '
date: '2013-02-16T05:31:00.004+05:00'
author: Abbas Raza
tags: 
modified_time: '2013-02-16T05:33:21.430+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-8439402597035100123
blogger_orig_url: https://abbas-raza.blogspot.com/2013/02/a-quick-and-dirty-summary-miibus.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div style="text-align: left;">(Robert Watson and Warner Losh)</div><div class="line874"><span class="anchor" id="line-4"></span></div><div class="line874">The  IEEE 802.3 standard defines a separation of function within any network  attached device.  The simplest of these separations was introduced for  the 100Base standards.  Among other things, it defined a standard  connection and protocol between a MAC (a computer device that produced  and consumed packets) and a PHY (a chip that converted the digital  packet streams into some encoded analog network media such as 10BaseT,  100BaseTx, etc).  The connection between these two layers is named MII.   Later versions of the standard defined other classes of connection.   Gigabit Ethernet added GMII.  10G Ethernet added XAUI.  For the purpose  of this document, MII will refer to all of these technologies. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span></div><div class="line874">The  Media Independent Interface (MII) layer defines a standard interface  connecting network interface MACs with PHYs.  It defines a protocol to  represent information about the device regarding device capabilities,  link status, identity etc. MII is a simple bus protocol driven by the  MAC, but exposed via PCI (or similar) to the OS device driver. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span></div><div class="line874">Several  devices (typically PHYs) may be present on an MII bus, each addressed  using a 5-bit device ID.  Further, each device can expose several  registers, which may be set or retrieved, identified by a 5-bit register  IDs. This allows addressing requests to specific devices, as well as  enumerating devices through standard interpretations of registers. On a  boring NIC, you might have a single MAC hooked up to one PHY (a  10Mbps/100Mbps/1Gbps RJ-45 UTP port) via MII, but on an embedded board,  multiply PHYs might appear on the same MII bus, each with its own  address. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></div><div class="line874">Because  MII and friends exist in most (all) network interface devices, and is  functionally extremely similar across devices, FreeBSD provides an  abstraction, miibus(4), used by most device drivers.  Device drivers  implement MII register read and write methods on their device_t, mapping  operations into device driver-specific I/O, such as PCI reads and  writes. As PHYs vary, different PHY drivers may attach, based on its OUI  returned during enumeration. Device drivers can then map network  ioctls, such as media requests, into MII operations, which miibus(4)  will arrange to be handled appropriately. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><br /><h2 style="text-align: left;">Simplified world view: MAC, MII, and PHY</h2></div><div class="line867"></div><div style="text-align: left;">The  world of NICs (Network Interface Controllers) is full of sometimes  ambiguously used terminology; for our purposes, a MAC (Media Access  Controller) is, effectively, the logic implementing an ethernet network  interface, and the PHY is the physical component implementing the  network physical layer.  They are linked by several communication  channels, including MII data, MII clock, as well as data send and  receive channels carrying network data.</div><div class="line874"><span class="anchor" id="line-16"></span></div><div class="line867"><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></div><pre><span class="anchor" id="line-1"></span>                 +-------+       MII           +-------+<br /><span class="anchor" id="line-2"></span>                 |       | === MII DATA ====== |       |<br /><span class="anchor" id="line-3"></span>                 |       | === MII CLOCK ===== |       |<br /><span class="anchor" id="line-4"></span> ... === PCI === |  MAC  |                     |  PHY  | === (real fibre and copper and stuff) ...<br /><span class="anchor" id="line-5"></span>                 |       | === DATA RECEIVE == |       |<br /><span class="anchor" id="line-6"></span>                 |       | === DATA SEND ===== |       |<br /><span class="anchor" id="line-7"></span>                 +-------+                     +-------+</pre><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><br /><div class="line867"></div><h2 id="Simplified_world_view:_MII_communication_traces"></h2></div>