---
layout: post
title: debugging tcp connections
date: '2015-10-02T06:03:00.000+05:00'
author: Abbas Raza
tags: 
modified_time: '2015-10-02T06:03:24.692+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-468021268276343846
blogger_orig_url: https://abbas-raza.blogspot.com/2015/10/debugging-tcp-connections.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1"><b>Connection establishment:</b></span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1">10:54:07.084214 IP 146.108.214.16.62783 &gt; 146.108.214.5.443: Flags [S], seq 783074551, win 65535, options [mss 1460,nop,wscale 5,nop,nop,TS val 167668029 ecr 0,sackOK,eol], length 0</span></div><div class="p1"><span class="s1">10:54:07.085391 IP 146.108.214.5.443 &gt; 146.108.214.16.62783: Flags [S.], seq 510189642, ack 783074552, win 28960, options [mss 1460,sackOK,TS val 906725978 ecr 167668029,nop,wscale 7], length 0</span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><b>Data Transfer:</b></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1">10:54:07.085466 IP 146.108.214.16.62783 &gt; 146.108.214.5.443: Flags [.], ack 1, win 4117, options [nop,nop,TS val 167668030 ecr 906725978], length 0</span></div><div class="p1"><span class="s1">10:54:07.088780 IP 146.108.214.16.62783 &gt; 146.108.214.5.443: Flags [P.], seq 1:171, ack 1, win 4117, options [nop,nop,TS val 167668033 ecr 906725978], length 170</span></div><div class="p1"><span class="s1">10:54:07.089768 IP 146.108.214.5.443 &gt; 146.108.214.16.62783: Flags [.], ack 171, win 235, options [nop,nop,TS val 906725979 ecr 167668033], length 0</span></div><div class="p1"><span class="s1">10:54:07.095202 IP 146.108.214.5.443 &gt; 146.108.214.16.62783: Flags [.], seq 1:1449, ack 171, win 235, options [nop,nop,TS val 906725980 ecr 167668033], length 1448</span></div><div class="p1"><br /></div><div class="p1"><br /></div><div class="p1"><b>Connection Closing/termination:</b></div><div class="p1"><b><br /></b></div><div class="p1">10:54:26.316361 IP 146.108.214.16.62783 &gt; 146.108.214.5.443: Flags [F.], seq 1397, ack 3071, win 4096, options [nop,nop,TS val 167687192 ecr 906729756], length 0</div><br /><div class="p1"><span class="s1">10:54:26.317551 IP 146.108.214.5.443 &gt; 146.108.214.16.62783: Flags [F.], seq 3071, ack 1398, win 269, options [nop,nop,TS val 906730785 ecr 167687192], length 0</span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1"><span class="s1"><b>Flags:</b></span></div><div class="p1"></div><div class="simplesect" lang="en" style="-webkit-text-stroke-width: 0px; background-color: white; color: black; font-family: Georgia, serif; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.8px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px;"></div><br /><div class="simplesect" lang="en" style="background-color: white; orphans: auto; text-align: start; text-indent: 0px; widows: 1;"><div class="itemizedlist"><ul style="-webkit-text-stroke-width: 0px; color: black; font-family: Georgia, serif; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.8px; list-style-position: inside; text-transform: none; white-space: normal; word-spacing: 0px;" type="disc"><li>S: SYN (Synchronize sequence numbers - Connection establishment)</li><li>F: FIN (Ending of sending by sender - Connection termination)</li><li>R: RST (Reset connection)</li><li>P: PSH (Push data)</li><li>.: (No flag is set)</li></ul><div style="-webkit-text-stroke-width: 0px; color: black; font-family: Georgia, serif; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.8px; text-transform: none; white-space: normal; word-spacing: 0px;"><br /></div><div style="-webkit-text-stroke-width: 0px; color: black; font-family: Georgia, serif; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 20.8px; text-transform: none; white-space: normal; word-spacing: 0px;"><b>References:</b></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b>http://www.linuxjournal.com/article/6447?page=0,0</b></span></span></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b>http://www.rogerclarke.com/II/IPrimerhttp-dump.html</b></span></span></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b><br /></b></span></span></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b>So you can see using&nbsp;</b></span></span></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b><br /></b></span></span></div><div>       <div class="p1"><span class="s1">sudo tcpdump -i en0 -nn host 146.108.214.5&nbsp; and port 443</span></div><div class="p1"><span class="s1"><br /></span></div><div class="p1">that whether the connection is established once and then data is transferred&nbsp;</div><div class="p1">OR</div><div class="p1">whether the connection is established --&gt;data transferred --&gt; connection closed --&gt; connection establish --&gt; data transfer --&gt; connection closed</div><div class="p1"><br /></div><div class="p1"><br /></div><div class="p1">When server is not reachable/service (apache) is not available/tcp port blocked</div><div class="p1">then&nbsp;</div><div class="p1">host will send S and get R in reply.</div><div class="p1">once the service is up again, host sends S and receives S in reply and data starts.</div><div class="p1"><br /></div><div class="p1"><b>To block/close a port: lets say 80 on server</b></div><div class="p1"><br /></div><div class="p1"><b>sudo fuser -k 80/tcp</b></div></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b><br /></b></span></span></div><div><span style="font-family: Georgia, serif;"><span style="line-height: 20.8px;"><b><br /></b></span></span></div></div></div></div>