---
layout: post
title: Determining the Correct Module
date: '2013-02-22T19:32:00.000+05:00'
author: Abbas Raza
tags: 
modified_time: '2013-02-22T19:52:49.342+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-388183153038084041
blogger_orig_url: https://abbas-raza.blogspot.com/2013/02/determining-correct-module.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div class="doctext"></div><div class="doctext">Sometimes you do not have the option of getting a distribution kernel working on a machine in order to determine what kernel modules are needed to drive the hardware. Or you have added new hardware to your system, and you need to figure out what kernel configuration option needs to be enabled to get it to work properly. This section will help you determine how to find that configuration option to get the hardware up and running.</div><div class="doctext"><br /></div><div class="doctext">The easiest way to figure out which driver controls a new device is to build all of the different drivers of that type in the kernel source tree as modules, and let the udev startup process match the driver to the device. Once this happens, you should be able to work backwards using the steps just discussed to determine the proper driver needed, and then go back and enable just that driver in the kernel configuration.</div><div class="doctext"><br /></div><div class="doctext">But if you do not want to build all drivers, or this does not work for some reason, it will require a bit more work to determine the proper driver that is needed. The following steps are complex and require digging in the kernel source code at times. Do not be afraid of this; it will only help you understand your hardware and the kernel source better.</div><div class="doctext"><br /></div><div class="doctext">The steps involved in matching the driver to the device differ depending on the type of device that you are working with. We will discuss the two most common forms of devices in this chapter: PCI and USB devices. The methods described here will also work with other types of devices.&nbsp;</div><div class="doctext"><br /></div><div class="doctext"></div><h4 class="docsection2title" id="title-idacwbxc"><u>USB Devices:</u></h4><h4 class="docsection2title" id="title-idacwbxc"><span style="font-weight: normal;">insert your device into system and run<br />1) lsusb</span><span style="color: #cc0000;"> </span><div style="text-align: left;"><span style="font-weight: normal;">Bus 001 Device 004: ID 0fe6:9700</span></div><div style="text-align: left;"><span style="font-weight: normal;">For this device, the vendor ID is 0fe6 and the product ID is 9700</span></div><div style="text-align: left;"><span style="font-weight: normal;">2) Grep this vendor id in kernel source&nbsp;</span></div><span style="font-weight: normal;">abbas@desktop:git$ grep -Irn "0fe6" drivers/</span><br /><span style="font-weight: normal;">drivers/net/usb/dm9601.c:650:<span class="Apple-tab-span" style="white-space: pre;"> </span>USB_DEVICE(0x0fe6, 0x8101),<span class="Apple-tab-span" style="white-space: pre;"> </span>/* DM9601 USB to Fast Ethernet Adapter */</span><br /><span style="font-weight: normal;">drivers/net/usb/dm9601.c:654:<span class="Apple-tab-span" style="white-space: pre;"> </span> USB_DEVICE(0x0fe6, 0x9700),<span class="Apple-tab-span" style="white-space: pre;"> </span>/* DM9601 USB to Fast Ethernet Adapter */</span><br /><span style="font-weight: normal;">drivers/staging/media/solo6x10/osd-font.h:146:<span class="Apple-tab-span" style="white-space: pre;"> </span>0x00000000, 0x0000fe60, 0x30180cfe, 0x00000000,</span><br /><span style="font-weight: normal;">3) So this device is and USB to Ethernet adopter and using&nbsp;drivers/net/usb/dm9601.c driver.</span><br /><div><div style="font-weight: normal;"><br /></div><u>PCI Devices:</u></div></h4>Here are the steps needed in order to find which PCI driver can control a specific PCI device:<br />&nbsp; &nbsp; 1) Find the PCI bus ID of the device for which you want to find the driver, using lspci .<br />&nbsp; &nbsp; 2) Go into the /sys/bus/pci/devices/0000: bus_id directory, where bus_id is the PCI bus ID found in the previous step.<br />&nbsp; &nbsp; 3) Read the values of the vendor and device files in the PCI device directory.<br />&nbsp; &nbsp; 4) Move back to the kernel source tree and look in include/linux/pci_ids.h for the PCI vendor and device IDs found in the previous step.<br />&nbsp; &nbsp; 5) Search the kernel source tree for references to those values in drivers. Both the vendor and device ID should be in a struct pci_device_id definition.<br />&nbsp; &nbsp; 6) Search the kernel Makefiles for the CONFIG_ rule that builds this driver by using find and grep :<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $&nbsp; &nbsp;find -type f -name Makefile &nbsp;xargs grep DRIVER_NAME<br /><br />&nbsp; &nbsp; 7) Search in the kernel configuration system for that configuration value and go to the location in the menu that it specifies to enable that driver to be built.<br /><br /><br /></div>