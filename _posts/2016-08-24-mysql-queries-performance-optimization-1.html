---
layout: post
title: mysql queries performance optimization 1
date: '2016-08-24T16:13:00.002+05:00'
author: Abbas Raza
tags: 
modified_time: '2016-08-24T16:13:24.004+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-2530289420483422997
blogger_orig_url: https://abbas-raza.blogspot.com/2016/08/mysql-queries-performance-optimization-1.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><h2 style="background-color: white; color: #172232; font-family: -apple-system, &quot;.SFNSDisplay-Regular&quot;, &quot;Open Sans&quot;, sans-serif; font-size: 13px; line-height: 15.86px; margin: 10px 0px 4px; padding: 0px; width: 650px;"><a href="http://www.howtogeek.com/howto/programming/speed-up-your-web-site-with-mysql-query-caching/" rel="bookmark" style="color: #172232; font-family: &quot;Open Sans&quot;, sans-serif; font-size: 19.76px; letter-spacing: -1px; text-decoration: none;" title="Speed Up Your Web Site With MySQL Query Caching">Speed Up Your Web Site With MySQL Query Caching</a></h2><div class="thecontent" style="background-color: white; font-family: -apple-system, &quot;.SFNSDisplay-Regular&quot;, &quot;Open Sans&quot;, sans-serif; font-size: 14.82px; margin: 0px -50px 0px 0px; padding: 0px;"><div style="color: #222222; line-height: 21px; margin-bottom: 20px; padding: 0px;">One of the best ways to speed up your web application is to enable query caching in your database, which caches commonly used SQL queries in memory for virtually instant access by the next page that makes the same request.</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">The reason this method is so powerful is that you don’t have to make any changes to your web application, you just have to sacrifice a little bit of memory. This isn’t going to fix all of your problems, but it definitely can’t hurt.</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Note: if your application updates tables frequently, then the query cache will be constantly purged and you won’t get much or any benefit from this. This is ideal for an application that mostly does reads against the database, such as a WordPress blog. This also won’t work if you are running on shared hosting.</div><div class="inlinessp" style="margin: -5px 0px -20px; max-height: 250px; min-height: 25px; overflow: hidden; padding: 0px; width: 650px;"><img border="0" height="1" src="https://bttrack.com/Pixel/Check/743224026?1471738158" style="border: 0px; margin-left: -2px;" width="1" /></div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;"><span style="font-weight: 600;">Enable Caching with Server Running</span></div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">The first thing you’ll want to do is make sure that your installation of MySQL actually has query caching support available. Most distributions do, but you should check anyway.</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">You’ll want to run this command from your MySQL console, which will tell you if query caching is available.</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">mysql&gt; show variables like 'have_query_cache';<br />+------------------+-------+<br />| Variable_name    | Value |<br />+------------------+-------+<br />| have_query_cache | YES   |<br />+------------------+-------+<br /></pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Don’t mistake this as meaning that query caching is actually enabled, because most hosting providers aren’t going to enable this by default. Oddly enough, my Ubuntu Feisty installation already had it enabled…</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Next we’ll need to check and see if query caching is enabled. We’ll need to check more than one variable, so we may as well do it all at once by checking for the variable query%</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">mysql&gt; show variables like 'query%';<br />+------------------------------+---------+<br />| Variable_name                | Value   |<br />+------------------------------+---------+<br />| query_alloc_block_size       | 8192    |<br />| query_cache_limit            | 1048576 |<br />| query_cache_min_res_unit     | 4096    |<br />| query_cache_size             | 8388608 |<br />| query_cache_type             | ON      |<br />| query_cache_wlock_invalidate | OFF     |<br />| query_prealloc_size          | 8192    |<br />+------------------------------+---------+<br /></pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Here’s the important items in the list and what they mean:</div><ul style="color: #333333; line-height: 21px; margin: 0px 0px 0px 15px; padding: 0px;"><li style="list-style: disc; margin: 0px 0px 10px 15px; padding: 0px;"><span style="font-weight: 600;">query_cache_size</span>&nbsp;– This is the size of the cache in bytes. Setting this value to 0 will effectively disable caching.</li><li style="list-style: disc; margin: 0px 0px 10px 15px; padding: 0px;"><span style="font-weight: 600;">query_cache_type</span>&nbsp;– This value must be ON or 1 for query caching to be enabled by default.</li><li style="list-style: disc; margin: 0px 0px 10px 15px; padding: 0px;"><span style="font-weight: 600;">query_cache_limit</span>&nbsp;– This is the maximum size query (in bytes) that will be cached.</li></ul><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">If the query_cache_size value is set to 0 or you just want to change it, you’ll need to run the following command, keeping in mind that the value is in bytes. For instance, if you wanted to allocate 8MB to the cache we’d use 1024 * 1024 * 8 = 8388608 as the value.</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">SET GLOBAL query_cache_size = 8388608;</pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Similarly, the other options can be set with the same syntax:</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">SET GLOBAL query_cache_limit = 1048576;</pre><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">SET GLOBAL <code style="line-height: 12.471px; margin: 0px; padding: 0px;">query_cache_type</code> = 1;</pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Now how do we tell if it’s actually working? You can use the SHOW STATUS command to pull all the variables that start with “Qc” to take a look at what is going on under the hood.</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">mysql&gt; SHOW STATUS LIKE 'Qc%';<br />+-------------------------+--------+<br />| Variable_name           | Value  |<br />+-------------------------+--------+<br />| Qcache_free_blocks      | 65     | <br />| Qcache_free_memory      | 201440 | <br />| Qcache_hits             | 18868  | <br />| Qcache_inserts          | 2940   | <br />| Qcache_lowmem_prunes    | 665    | <br />| Qcache_not_cached       | 246    | <br />| Qcache_queries_in_cache | 492    | <br />| Qcache_total_blocks     | 1430   | <br />+-------------------------+--------+<br />8 rows in set (0.00 sec)<br /></pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">You’ll notice in the stats that I have plenty of free memory left. If your server shows a lot of lowmem prunes, you might need to consider increasing this value, but I wouldn’t spend too much memory on query caching for a web server… you need to leave memory available for apache, php, ruby, or whatever you are using.</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;"><span style="font-weight: 600;">Enable in Config File</span></div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">If you want these changes to survive a reboot or restart of the mysql server, you’ll need to add them into your /etc/mysql/my.cnf configuration file for MySQL. Note that it might be in a different location on your installation.</div><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Open up the file using a text editor in sudo or root mode, and then add these values if they don’t already exist in the file. If they do exist, just uncomment them.</div><blockquote style="background-color: #f9f9f9; border: 1px dashed rgb(47, 111, 171); clear: both; font-family: monospace; line-height: 1.1em; margin: 0px 0px 10px; max-width: 618px; overflow-x: auto; padding: 10px;"><pre style="font-size: 12.597px; line-height: 12.471px; padding: 0px;">query_cache_size = 268435456<br />query_cache_type=1<br />query_cache_limit=1048576</pre></blockquote><div style="color: #222222; line-height: 21px; margin-bottom: 20px; margin-top: 20px; padding: 0px;">Query caching can significantly improve the speed of your web application, especially if your application does mostly reads. Monitor the status using the methods above and see how it works over time.</div></div></div>