---
layout: post
title: Implementing a System call in Linux Kernel 2.6.35
date: '2012-01-20T02:02:00.000+05:00'
author: Abbas Raza
tags:
- Linux kernel
- system call
modified_time: '2012-01-20T02:02:40.906+05:00'
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-7024865357552811232
blogger_orig_url: https://abbas-raza.blogspot.com/2012/01/implementing-system-call-in-linux.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div class="entrytext" style="overflow-x: hidden; overflow-y: hidden; padding-top: 0px;"><span style="background-color: white;"><span style="font-family: 'Courier New', Courier, monospace;"></span></span><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">As we know, System calls are a set of services/functions provided to the programmer by the OS. These functions can be invoked in any language that provide some interface to the System call mechanism of the OS. Some common linux system calls are open,read,write etc.<br />While executing a system call, the calling process moves from user space to kernel space and back to user space when its completes executing the call.</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">There are around 338 system calls in linux kernel&nbsp; 2.6.35.7 by default. Presented here a howto on adding a new one into the kernel, a 339<sup>th</sup>&nbsp;one so that it will be available globally for any program. As example, we will implement the&nbsp;<strong>strcpy</strong>&nbsp;function as a system call so that it can be used without including string.h.</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Obviously, you need the kernel source tree since some kernel modification is involved. Get it from&nbsp;<a href="http://www.kernel.org/" style="font-weight: bold; text-decoration: none;" target="_blank" title="Linux Kernel Source">kernel.org&nbsp;</a>(any kernel version higher than 2.6.35.7 would work fine )and untar it to get linux-2.6.35.7. The paths used below all will be relative to this path.<br />We need to edit 4 files and 2 files need to be created.</span></div><h2><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">The Code</span></h2><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">First, lets start off writing the code for strcpy. We need to include the file&nbsp;<strong>linux/linkage.h</strong>&nbsp;because it contains the macro&nbsp;<strong>asmlinkage</strong>&nbsp;which means that the system call expects the arguments on the stack and not in registers. Printk is the kernel alternative of printf, but with certain peculiar properties.</span></div><div class="wp-caption aligncenter" id="attachment_269" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 437px;"><a href="http://appusajeev.files.wordpress.com/2010/11/strcpy.png" style="font-weight: bold; text-decoration: none;"><span style="background-color: white; color: black; font-family: 'Courier New', Courier, monospace;"><img alt="Code for the system call " class="size-full wp-image-269" height="266" src="http://appusajeev.files.wordpress.com/2010/11/strcpy.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Code for the system call " width="427" /></span></a><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Code for the system call</span></div></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">“<strong>&lt;1&gt;</strong>” tells printk that we are giving that message the highest priority.</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Create a folder named ‘<strong>test</strong>’ in the root of linux source directory and save this file as&nbsp;<strong>strcpy.c</strong>&nbsp;in that directory. Create a&nbsp;<strong>Makefile</strong>&nbsp;in that directory containing only the line.</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">obj-y:=strcpy.o</span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Thus, now the strcpy.c file and Makefile are present in<strong></strong></span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><strong>linux-2.6.35.7/test/strcpy.c&nbsp;</strong><br /><strong>linux-2.6.35.7/test/Makefile</strong><strong></strong></span></div><h2><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">The Edits</span></strong></h2><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">The following files need to be edited.<strong><br /></strong></span></div><h3><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">1. linux-2.6.35.7/arch/x86/kernel/syscall_table_32.S</span></h3><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Append to the file the following line<span style="line-height: 17px;"></span></span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><strong>.long sys_strcpy&nbsp;</strong><span style="line-height: 17px;"><br /></span></span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;"><span style="background-color: white; line-height: 17px;"></span></span></div><div class="wp-caption aligncenter" id="attachment_275" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 390px;"><a href="http://appusajeev.files.wordpress.com/2010/11/table.png" style="font-weight: bold; text-decoration: none;"><span style="background-color: white; color: black; font-family: 'Courier New', Courier, monospace;"><img alt="linux-2.6.35/arch/x86/kernel/syscall_table_32.S" class="size-full wp-image-275" height="198" src="http://appusajeev.files.wordpress.com/2010/11/table.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="linux-2.6.35/arch/x86/kernel/syscall_table_32.S" width="380" /></span></a><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">linux-2.6.35/arch/x86/kernel/syscall_table_32.S</span></div></div><h3><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">2. linux-2.6.35.7/arch/x86/include/asm/unistd_32.h</span></h3><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">This file contains the unique number associated with each system call. We can see the names of all the system calls and the number associated with each. After the last system call-number pair (around line 345), add a line</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">#define __NR_strcpy&nbsp; 338</span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><strong></strong>(if 337 was the number associated with the last system call).<br />Then replace NR_syscalls directive denoting the total number of system calls by the previous number incremented by 1 ie the new value is</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">#define NR_syscalls 339</span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Note down the number 338, we need it later.</span></div><div class="wp-caption aligncenter" id="attachment_276" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 317px;"><a href="http://appusajeev.files.wordpress.com/2010/11/numbers.png" style="font-weight: bold; text-decoration: none;"><span style="background-color: white; color: black; font-family: 'Courier New', Courier, monospace;"><img alt="linux-2.6.35/arch/x86/include/asm/unistd_32.h" class="size-full wp-image-276" height="188" src="http://appusajeev.files.wordpress.com/2010/11/numbers.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="linux-2.6.35/arch/x86/include/asm/unistd_32.h" width="307" /></span></a><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">linux-2.6.35/arch/x86/include/asm/unistd_32.h</span></div></div><h3><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">3. linux-2.6.35.7/include/linux/syscalls.h</span></h3><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">This file contains the prototype of all the system calls. Here we append to the file the prototype of our function.<br />ie. We add&nbsp; the line</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">asmlinkage&nbsp; long sys_strcpy(char *dest,char *src);</span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><br /></span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong style="background-color: white;"><span style="font-family: 'Courier New', Courier, monospace;"></span></strong></div><div class="wp-caption aligncenter" id="attachment_277" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 554px;"><strong><a href="http://appusajeev.files.wordpress.com/2010/11/proto.png" style="text-decoration: none;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><img alt="linux-2.6.35/include/linux/syscalls.h" class="size-full wp-image-277" height="110" src="http://appusajeev.files.wordpress.com/2010/11/proto.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="linux-2.6.35/include/linux/syscalls.h" width="544" /></span></a></strong><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">linux-2.6.35/include/linux/syscalls.h</span></div></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><strong></strong></span></div><h3><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">4. Makefile</span></h3><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Open Makefile present in the root of source directory and find the area where&nbsp;<strong>core-y</strong>&nbsp;is defined and add the folder&nbsp;<strong>test</strong>&nbsp;to the end of that line as shown below</span></div><div class="wp-caption aligncenter" id="attachment_278" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 576px;"><a href="http://appusajeev.files.wordpress.com/2010/11/makefile.png" style="font-weight: bold; text-decoration: none;"><span style="background-color: white; color: black; font-family: 'Courier New', Courier, monospace;"><img alt="Makefile" class="size-full wp-image-278" height="123" src="http://appusajeev.files.wordpress.com/2010/11/makefile.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="Makefile" width="566" /></span></a><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Makefile</span></div></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Next compile the kernel. Assuming you are familiar with kernel compilation, execute<br /><strong>make bzImage&nbsp; –j4</strong><br />The last argument is optional and is intended to speed up compilation on dual core CPUS<br />Once compilation is complete, install the kernel by executing the following command with root permission<br /><strong>make install</strong><br />Once the kernel image is installed to /boot, reboot the system.</span></div><h2><span style="background-color: white; font-family: 'Courier New', Courier, monospace; font-size: small;">Testing</span></h2><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Now we need to check the newly done system call. Run the code below and feel the satisfaction&nbsp;<img alt=":)" class="wp-smiley" src="http://s0.wp.com/wp-includes/images/smilies/icon_smile.gif?m=1305292933g" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: solid; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: solid; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: solid; border-right-width: 0px; border-style: initial; border-top-color: rgb(176, 176, 176); border-top-style: solid; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 97%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" /></span></div><div class="wp-caption aligncenter" id="attachment_279" style="border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-bottom-style: solid; border-bottom-width: 1px; border-image: initial; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-top-style: solid; border-top-width: 1px; margin-bottom: 5px; margin-left: auto; margin-right: auto; margin-top: 5px; max-width: 98%; padding-top: 4px; text-align: center; width: 401px;"><a href="http://appusajeev.files.wordpress.com/2010/11/sample.png" style="font-weight: bold; text-decoration: none;"><span style="background-color: white; color: black; font-family: 'Courier New', Courier, monospace;"><img alt="System call test" class="size-full wp-image-279" height="171" src="http://appusajeev.files.wordpress.com/2010/11/sample.png" style="border-bottom-color: rgb(176, 176, 176); border-bottom-style: none; border-bottom-width: 0px; border-color: initial; border-image: initial; border-left-color: rgb(176, 176, 176); border-left-style: none; border-left-width: 0px; border-right-color: rgb(176, 176, 176); border-right-style: none; border-right-width: 0px; border-top-color: rgb(176, 176, 176); border-top-style: none; border-top-width: 0px; height: auto; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; max-width: 99%; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="System call test" width="391" /></span></a><div class="wp-caption-text" style="line-height: 17px; padding-bottom: 5px; padding-left: 4px; padding-right: 4px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">System call test</span></div></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><strong><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">The kernel has performed the strcpy for us. Cool ! isn’t it</span></strong></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;"><strong>Note:</strong><br />Execute the command&nbsp;<strong>dmesg</strong>&nbsp;now, you can see done printed in the last. Printk by default doesnt&nbsp; print to the terminal. It writes to the kernel ring buffer which is printed by the dmesg</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">Try putting an infinite loop inside a system call, the system just drops dead. As it goes, the linux kernel does not preempt itself.</span></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"></div><div style="line-height: 1.5em; margin-bottom: 15px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"></div><div class="mcePaste" id="_mcePaste" style="height: 1px; left: -10000px; overflow-x: hidden; overflow-y: hidden; position: absolute; top: 539px; width: 1px;"><span style="background-color: white; font-family: 'Courier New', Courier, monospace;">&lt;1&gt; means that we are giving that message the highest priority Create a folder name ‘test’ in the root of linux source directory and save this file as strcpy.c in that directory . Create a makefile in that directory containing the line Obj-y:=strcpy.o The Edits The files to be edited are<strong>1 . /usr/src/linux-2.6.32.5/arch/x86/kernel/syscall_table_32.S</strong><strong>Append the line&nbsp; .long sys_strcpy to the file(Replace sys_strcpy with whatever name you want)</strong><strong>2.</strong><strong>/usr/src/linux-2.6.32.5/arch/x86/include/asm/unistd_32.h</strong><strong>This file contains the unique number associated with each system call. We can see the names of all the system calls and the number associated with each. After the last system call-number pair (around line 345), add a line<br />#define __NR_strcpy&nbsp; 338&nbsp; (if 337 was the number associated with the last system call).<br />Then replace NR_syscalls directive denoting the total number of system calls by the previous number incremented by 1 ie the new value id</strong><strong>#define NR_syscalls 339</strong><strong>Note down the number 338, we need it later.</strong><strong>3.</strong><strong>/usr/src/linux-2.6.32.5/include/linux/syscalls.h</strong><strong>This file contains the prototypes of system calls. Here we append to the file the prototype of our file.<br />ie. We add&nbsp; the line<br />asmlinkage&nbsp; long sys_strcpy(char *dest,char *src);</strong><strong></strong><strong>4. Makefile<br />Open makefile and find the area where core-y is defined and add the folder test to the end of that line as shown below</strong></span></div><div class="wpadvert" id="wpcom_below_post" style="margin-bottom: 10px; margin-left: auto; margin-right: auto; margin-top: 10px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px; text-align: center; width: 310px;"></div></div></div>