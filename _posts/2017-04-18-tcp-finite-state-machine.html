---
layout: post
title: TCP finite state machine
date: '2017-04-18T18:35:00.001+05:00'
author: Abbas Raza
tags: 
modified_time: '2017-04-18T20:08:15.476+05:00'
thumbnail: https://1.bp.blogspot.com/-MU_6cyzF_fg/WPYV3JuwnxI/AAAAAAAAMxo/IoxFwHxwR8sTPTGPNDrZF9OayzefdQAbQCLcB/s72-c/tcpfsm.png
blogger_id: tag:blogger.com,1999:blog-3367966882409306161.post-6926694326296291208
blogger_orig_url: https://abbas-raza.blogspot.com/2017/04/tcp-finite-state-machine.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Client = Client machine running tcp stack</div><div class="separator" style="clear: both; text-align: left;">Server = Server machine running tcp stack</div><div class="separator" style="clear: both; text-align: left;"></div><ol style="text-align: left;"><li>Client sends connection request by sending SYN</li><li>Client goes into <b><span style="background-color: lime; color: blue;">SYN_SENT</span></b> state.</li><li>Server is listening and is in <b><span style="background-color: lime; color: blue;">LISTEN</span></b> state.</li><li>Server receives SYN from client.</li><li>Server sends SYN along with the ACK (for the SYN received from client).</li><li>Now server goes into <span style="color: blue;"><b style="background-color: lime;">SYN_RECV</b></span> state.</li><li>Client now receives SYN and ACK from server.</li><li>Client sends ACK for the SYN from server.</li><li>Client goes to <b><span style="background-color: lime; color: blue;">ESTABLISHED</span></b> state.</li><li>Server receives ACK from client and goes to <span style="background-color: lime;"><span style="color: blue;"><b>ESTABLISHED</b></span></span> state.</li><li><span style="background-color: yellow;">connection/session is ESTABLISHED now</span> between server and client and they can exchange data.</li><li><b style="background-color: yellow;">After client has finished sending data</b>, it sends FIN to server.</li><li>Client goes to <b><span style="background-color: lime; color: blue;">FIN_WAIT1</span></b> state. Because it is waiting for an ACK for this 1st FIN of this session.</li><li>Server receives FIN from client and sends its ACK.</li><li>Server goes to <span style="color: blue;"><b style="background-color: lime;">CLOSE_WAIT</b></span>. It is called wait because client has closed the connection and now it is waiting for server app turn to close connection??</li><ul><li><u><b style="background-color: yellow;">Scenario # 1:</b></u></li><ul><li>Client receives ACK sent by server for FIN.</li><li>Client goes to <b><span style="background-color: lime; color: blue;">FIN_WAIT2</span></b> state. its now waiting for FIN from server.</li><li>Server now sends FIN after its finished.</li><li>Server goes to <b><span style="background-color: lime; color: blue;">LAST_ACK</span></b> state. It is waiting for ACK of the FIN.</li><li>Client receives FIN and sends ACK</li><li>Client goes to <b><span style="background-color: lime; color: blue;">TIME_WAIT</span></b> state. Wait for sometime to make sure that ACK has been received by server.</li><li>Server receives the last ACK and goes to <b><span style="background-color: lime; color: blue;">CLOSED</span></b> state.</li><li>After timer expires and everything is good (ACK not lost), client goes to <b><span style="background-color: lime; color: blue;">CLOSED</span></b> state.</li></ul></ul><ul><li><b><u style="background-color: yellow;">Scenario # 2:</u></b></li><ul><li>Server now sends FIN after its finished.</li><li>Server goes to&nbsp;<b><span style="background-color: lime; color: blue;">LAST_ACK</span></b>&nbsp;state. It is waiting for ACK of the FIN.</li><li>Client receives FIN and sends ACK.</li><li>Client goes to <b><span style="background-color: lime; color: blue;">CLOSING</span></b> state.</li><li>Client receives ACK sent by server for FIN.</li><li>Client goes to <span style="color: blue;"><b style="background-color: lime;">TIME_WAIT</b></span> state. Wait for sometime to make sure that ACK has been received by server.</li><li>Server receives the last ACK and goes to <b><span style="background-color: lime; color: blue;">CLOSED</span></b> state.</li><li>After timer expires and everything is good (ACK not lost), client goes to <b><span style="background-color: lime; color: blue;">CLOSED</span></b> state.</li></ul></ul></ol><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-MU_6cyzF_fg/WPYV3JuwnxI/AAAAAAAAMxo/IoxFwHxwR8sTPTGPNDrZF9OayzefdQAbQCLcB/s1600/tcpfsm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-MU_6cyzF_fg/WPYV3JuwnxI/AAAAAAAAMxo/IoxFwHxwR8sTPTGPNDrZF9OayzefdQAbQCLcB/s1600/tcpfsm.png" /></a></div><br /></div>